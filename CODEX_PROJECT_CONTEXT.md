# COMPLETE PROJECT CONTEXT FOR CODEX - Project Governance Tool

## ğŸ¯ What We're Building

A **Power Apps Code App** called **"Project Governance DV"** that helps manage projects, deliverables, staff, workstreams, and time tracking for 150+ users at PwC.

---

## ğŸ“Š Current Situation

### The Live Production App (SharePoint-based)
- **Type:** PowerApps Canvas App
- **Data Source:** SharePoint Lists
- **Users:** 150 people actively using it RIGHT NOW
- **Status:** LIVE in production

**SharePoint Lists in use:**
- Deliverables list
- Staff list
- Workstreams list
- PTO Requests list
- Weekly Hours list

### The New App We're Building (Dataverse-based)
- **Type:** PowerApps Code App (React + TypeScript)
- **Data Source:** Dataverse tables (NOT SharePoint anymore)
- **Status:** In development
- **App ID:** c6cc16c7-c9dc-4bbd-9034-7a9b0656f328
- **Environment:** deccb389-10c5-4d5c-8716-1093a04538e1 (PWC environment)

---

## ğŸ—„ï¸ Dataverse Tables (crda8_ prefix)

We created these Dataverse tables using `pac code add-data-source`:

1. **crda8_deliverables** (Deliverables)
   - Entity Set: `crda8_deliverableses`
   - Logical Name: `crda8_deliverables`
   - Fields: name, description, status, owner, due date, progress, risk level, workstream, etc.

2. **crda8_staff4** (Staff/Team Members)
   - Entity Set: `crda8_staff4s`
   - Logical Name: `crda8_staff4`
   - Fields: name, email, job title, role, supervisor, workstreams, active status, etc.

3. **crda8_workstreams** (Workstreams/Pods)
   - Entity Set: `crda8_workstreamses`
   - Logical Name: `crda8_workstreams`
   - Fields: name, description, lead, color, etc.

4. **crda8_timeoffrequests** (PTO/Time Off)
   - Entity Set: `crda8_timeoffrequestses`
   - Logical Name: `crda8_timeoffrequests`
   - Fields: staff member, start date, end date, type, status, etc.

5. **crda8_weeklyhours** (Weekly Hour Tracking)
   - Entity Set: `crda8_weeklyhourses`
   - Logical Name: `crda8_weeklyhours`
   - Fields: staff member, week, hours per deliverable, etc.

6. **crda8_appusagelog** (Usage Analytics)
   - Entity Set: `crda8_appusagelogs`
   - Tracks app usage

7. **crda8_audittrail2** (Audit Trail)
   - Entity Set: `crda8_audittrail2s`
   - Tracks all changes

8. **crda8_georgtown** (Test table)
   - Entity Set: `crda8_georgtowns`
   - Used for testing Dataverse connection

---

## ğŸ“ Project Structure

```
project-governance-dv/
â”œâ”€â”€ power.config.json              â† Dataverse configuration
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/                   â† All pages/screens
â”‚   â”‚   â”œâ”€â”€ AdminAnalytics.tsx     â† ğŸ¯ Admin screen with CSV bulk import
â”‚   â”‚   â”œâ”€â”€ DashboardEnhanced.tsx  â† Main dashboard (KPIs, activity feed)
â”‚   â”‚   â”œâ”€â”€ Deliverables.tsx       â† Deliverables management (table + kanban)
â”‚   â”‚   â”œâ”€â”€ Kanban.tsx             â† Kanban board view
â”‚   â”‚   â”œâ”€â”€ Gantt.tsx              â† Gantt chart timeline
â”‚   â”‚   â”œâ”€â”€ Staff.tsx              â† Staff directory
â”‚   â”‚   â”œâ”€â”€ Workstreams.tsx        â† Workstream management
â”‚   â”‚   â”œâ”€â”€ PTORequests.tsx        â† PTO request/approval
â”‚   â”‚   â”œâ”€â”€ HoursTracking.tsx      â† Weekly hour tracking
â”‚   â”‚   â”œâ”€â”€ OrgChartHierarchy.tsx  â† Org chart by reporting structure
â”‚   â”‚   â”œâ”€â”€ OrgChartWorkstream.tsx â† Org chart by workstream
â”‚   â”‚   â””â”€â”€ Login.tsx              â† Login screen
â”‚   â”œâ”€â”€ generated/                 â† Auto-generated by pac commands
â”‚   â”‚   â”œâ”€â”€ services/              â† Dataverse service classes
â”‚   â”‚   â”‚   â”œâ”€â”€ Crda8_deliverablesesService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Crda8_staff4sService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Crda8_workstreamsesService.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ models/                â† TypeScript models
â”‚   â”‚       â”œâ”€â”€ Crda8_deliverablesesModel.ts
â”‚   â”‚       â”œâ”€â”€ Crda8_staff4sModel.ts
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/                â† Reusable UI components
â”‚   â”‚   â”œâ”€â”€ Layout.tsx
â”‚   â”‚   â”œâ”€â”€ KanbanView.tsx
â”‚   â”‚   â”œâ”€â”€ TableView.tsx
â”‚   â”‚   â”œâ”€â”€ StatusBadge.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ data/                      â† Data layer
â”‚   â”‚   â”œâ”€â”€ dataLayer.ts           â† Data access layer (localStorage + Dataverse)
â”‚   â”‚   â”œâ”€â”€ auditLayer.ts          â† Audit logging
â”‚   â”‚   â”œâ”€â”€ dataverseConfig.ts     â† Dataverse config
â”‚   â”‚   â””â”€â”€ seed/                  â† Seed data (JSON files)
â”‚   â”‚       â”œâ”€â”€ staff.json         â† 60KB of staff data
â”‚   â”‚       â”œâ”€â”€ deliverables.json  â† 143KB of deliverable data
â”‚   â”‚       â”œâ”€â”€ workstreams.json
â”‚   â”‚       â”œâ”€â”€ pto.json
â”‚   â”‚       â””â”€â”€ audit.json
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx        â† Authentication
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts               â† TypeScript types
â”‚   â””â”€â”€ App.tsx                    â† Main app with routing
â””â”€â”€ package.json                   â† Dependencies
```

---

## ğŸš€ Current Task: CSV Bulk Import from SharePoint

### The Problem
The SharePoint lists have **live production data** from 150 users. We need to migrate this data to Dataverse tables without disrupting the live app.

### The Solution
Use the **Admin Analytics screen** which has CSV bulk import functionality.

### The Workflow

**Step 1: Export SharePoint Lists to CSV** (Georg will do this)
- Go to SharePoint
- Open each list (Deliverables, Staff, Workstreams, PTO, Weekly Hours)
- Export to CSV file
- Download CSV files

**Step 2: Wipe Dataverse Tables** (Georg will do this manually)
- Go to make.powerapps.com â†’ Tables
- Delete all test data from Dataverse tables
- Start with clean tables

**Step 3: Bulk Import CSVs via Admin Screen** (This is where we are now!)
- Open the Admin Analytics screen (`/admin`)
- Use the CSV import feature to upload each CSV file
- The app will:
  - Parse the CSV
  - Map CSV columns to Dataverse fields
  - Handle field name differences (SharePoint vs Dataverse)
  - Handle data type conversions
  - Preserve relationships between tables
  - Bulk create records in Dataverse

---

## ğŸ”§ How the CSV Import Works

### Location
**File:** `src/screens/AdminAnalytics.tsx`

### Key Features

1. **CSV Parsing** (`parseCsv` from `utils/csv`)
   - Reads CSV file
   - Parses into array of objects

2. **Field Mapping** (`mapCsvToDataverse`)
   - Maps CSV column names to Dataverse field names (crda8_*)
   - Handles field name normalization
   - Example: "Full Name" â†’ "crda8_name"

3. **Data Type Conversion**
   - Booleans: "true", "yes", "1" â†’ `true`
   - Numbers: Parse and validate
   - Dates: Format as ISO date-only (YYYY-MM-DD)
   - Text: Trim and clean

4. **Relationship Handling**
   - Staff â†’ Workstreams (many-to-many)
   - Deliverables â†’ Staff (owner lookup)
   - Deliverables â†’ Workstreams (lookup)
   - Staff â†’ Supervisor (self-referencing lookup)
   - Workstreams â†’ Lead (staff lookup)

5. **Bulk Import Functions**
   ```typescript
   // Import workstreams first (no dependencies)
   mapWorkstreams(csvRecords) â†’ Workstream[]

   // Import staff second (references workstreams)
   mapStaff(csvRecords, workstreamByName) â†’ Staff[]

   // Update workstream leads (after staff exists)
   mapWorkstreamLeads(workstreams, staff, csvRecords)

   // Import deliverables last (references staff + workstreams)
   mapDeliverables(csvRecords, staffByKey, workstreamByName) â†’ Deliverable[]
   ```

6. **Dataverse Service Calls**
   ```typescript
   // Uses generated services
   Crda8_staff4sService.create(payload)
   Crda8_deliverablesesService.create(payload)
   Crda8_workstreamsesService.create(payload)
   ```

---

## ğŸ“‹ Field Mappings (SharePoint CSV â†’ Dataverse)

### Staff Fields
```
SharePoint CSV Column â†’ Dataverse Field
----------------------------------------
FullName â†’ crda8_name
Email â†’ crda8_email
JobTitle â†’ crda8_jobtitle (and normalized to title enum)
Role â†’ crda8_role
Supervisor â†’ crda8_supervisor (lookup by email/name)
Workstreams â†’ crda8_workstreams (multi-select lookup)
Active â†’ crda8_active (boolean)
Notes â†’ crda8_department
```

### Deliverable Fields
```
SharePoint CSV Column â†’ Dataverse Field
----------------------------------------
Title â†’ crda8_name
Description â†’ crda8_description
Status â†’ crda8_status (normalized: Not Started, In Progress, etc.)
Owner â†’ crda8_owner (lookup to staff)
DueDate â†’ crda8_duedate (date-only format)
Progress â†’ crda8_completion_x0020__x0025_ (number 0-100)
RiskLevel â†’ crda8_risk (normalized: Low, Medium, High, Critical)
Workstream â†’ crda8_workstream (lookup)
Priority â†’ crda8_priority
```

### Workstream Fields
```
SharePoint CSV Column â†’ Dataverse Field
----------------------------------------
WorkstreamName â†’ crda8_name
Title â†’ crda8_name (fallback)
Description â†’ crda8_description
Leader â†’ crda8_lead (lookup to staff, resolved after staff import)
```

---

## âš ï¸ Known Issues from SharePoint Migration

### 1. Lookups Became Text Fields
When tables were created from SharePoint lists, **lookup fields became text fields**.

**Problem:**
- SharePoint: "Owner" is a lookup to Staff list (stores ID + name)
- Dataverse after migration: "crda8_owner" is just TEXT field

**Solution:**
Either:
- A) Keep as text fields and store names as strings
- B) Recreate as proper lookup columns in Dataverse (recommended)

**To fix properly:**
1. Go to make.powerapps.com â†’ Tables â†’ crda8_deliverables
2. Find "crda8_owner" column
3. Change type from "Text" to "Lookup"
4. Point it to crda8_staff4 table
5. Re-run: `pac code add-data-source -a dataverse -t crda8_deliverables`

### 2. Field Name Differences
SharePoint uses friendly names, Dataverse uses logical names with prefix.

**Always use Dataverse logical names in code:**
- âœ… `crda8_name`
- âŒ `Name` or `Title`

---

## ğŸ¨ UI Features Implemented

### Dashboard (DashboardEnhanced.tsx)
- KPI cards (total deliverables, at risk, completed, team size)
- Recent activity feed with avatars and timestamps
- Progress by workstream
- Upcoming deadlines
- Risk overview

### Deliverables Screen
- Table view with sorting, filtering, search
- Kanban view (drag-and-drop columns by status)
- Status badges with colors
- Edit/delete functionality
- Create new deliverables

### Kanban Board
- Columns: Not Started, In Progress, At Risk, Completed, Blocked
- Drag-and-drop cards between columns
- Card shows: name, owner avatar, due date, progress bar

### Gantt Chart
- Timeline view of deliverables
- Grouped by workstream
- Shows dependencies and progress

### Staff Directory
- Grid view with avatars
- Shows: name, title, email, workstreams
- Filter by workstream
- Active/inactive status

### Admin Analytics
- **CSV Bulk Import** ğŸ“¥ â† We're working on this!
- Usage statistics
- Audit log viewer
- Data management

---

## ğŸ”‘ Key Technologies

### Frontend
- **React 18** with TypeScript
- **React Router** for navigation
- **React Query** for data caching
- **Lucide React** for icons
- **Custom CSS** (not Tailwind)

### Data Layer
- **@microsoft/power-apps-data** SDK
- Generated services from `pac code add-data-source`
- localStorage for caching (with Dataverse sync)
- Audit logging layer

### Authentication
- AuthContext with mock users for development
- Will integrate with SSO later

---

## ğŸ¯ Current Status & Next Steps

### âœ… What's Working
- Dataverse tables created and configured
- Generated services and models for all tables
- All screens built (Dashboard, Deliverables, Kanban, Gantt, Staff, etc.)
- Basic CRUD operations
- View switching (Table â†” Kanban)
- Admin Analytics screen with CSV import UI

### ğŸš§ What We're Working On NOW
**CSV Bulk Import Feature:**
- Testing CSV parsing with real SharePoint export data
- Handling field mapping (SharePoint columns â†’ Dataverse fields)
- Preserving relationships (owner lookups, workstream references, supervisors)
- Bulk creating records in Dataverse
- Error handling for malformed data

### ğŸ“ What's Next
1. Test CSV import with actual SharePoint exports
2. Verify all relationships are preserved
3. Handle edge cases (missing data, invalid formats)
4. Add progress indicators for large imports
5. Add validation before import
6. Test with production data volume (150+ staff, 1000+ deliverables)

---

## ğŸ” Important Notes for Codex

### Data Access Pattern
```typescript
// ALWAYS use generated services
import { Crda8_staff4sService } from '../generated'

// Create
const result = await Crda8_staff4sService.create({
  crda8_name: "John Doe",
  crda8_email: "john@pwc.com",
  crda8_active: true
})

// Check success
if (!result.success) {
  throw result.error
}

// Use data
const newStaff = result.data
```

### Field Names
```typescript
// âœ… CORRECT - Use Dataverse logical names
{
  crda8_name: "John",
  crda8_email: "john@pwc.com",
  crda8_active: true
}

// âŒ WRONG - Don't use display names
{
  Name: "John",
  Email: "john@pwc.com",
  Active: true
}
```

### CSV Import Order
**CRITICAL: Import in this order due to relationships!**
1. Workstreams first (no dependencies)
2. Staff second (references workstreams)
3. Update workstream leads (after staff exists)
4. Deliverables last (references both staff and workstreams)

### Testing CSV Import
```typescript
// Example test flow
1. Export Staff list from SharePoint â†’ staff.csv
2. Go to /admin in the app
3. Click "Import Staff CSV"
4. Select staff.csv
5. App parses CSV â†’ maps fields â†’ calls Crda8_staff4sService.create() for each row
6. Verify in make.powerapps.com â†’ Tables â†’ crda8_staff4 â†’ Data
```

---

## ğŸ“‚ Key Files to Know

**Configuration:**
- `power.config.json` - Dataverse connection config

**Screens:**
- `src/screens/AdminAnalytics.tsx` - CSV import (CURRENT WORK)
- `src/screens/DashboardEnhanced.tsx` - Main dashboard
- `src/screens/Deliverables.tsx` - Deliverables management

**Data Layer:**
- `src/data/dataLayer.ts` - Data access abstraction
- `src/generated/services/Crda8_staff4sService.ts` - Staff service (auto-generated)
- `src/generated/models/Crda8_staff4sModel.ts` - Staff model (auto-generated)

**Types:**
- `src/types/index.ts` - TypeScript interfaces

**Utilities:**
- `src/utils/csv.ts` - CSV parsing utility

---

## ğŸ¯ The Goal

**Build a production-ready governance tool that:**
1. âœ… Connects to Dataverse (not SharePoint)
2. âœ… Works for 150+ users
3. ğŸš§ Imports existing SharePoint data via CSV
4. âœ… Has beautiful UI (inspired by Lovable app design)
5. âœ… Tracks deliverables, staff, workstreams, PTO, hours
6. âœ… Has analytics and audit trails
7. ğŸ”œ Replaces the old SharePoint canvas app

---

## ğŸ’¡ Remember

- **Don't modify generated files** in `src/generated/`
- **Always use crda8_ field names** in code
- **Check result.success** before using result.data
- **Test with small CSV first**, then scale up
- **Import order matters** (workstreams â†’ staff â†’ deliverables)
- **The live SharePoint app is still running** - this is a migration, not a replacement yet

---

You're now fully up to speed! We're currently working on the CSV bulk import feature in AdminAnalytics.tsx to migrate production data from SharePoint lists to Dataverse tables. ğŸš€
