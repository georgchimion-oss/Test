# Power Apps Code App Template

This is a complete working template based on the **GeorgCodeTemplate** that successfully connects to Dataverse.

## âœ… What's Included

This template is ready to use with your Dataverse tables:
- `crda8_deliverables`
- `crda8_staff4`
- `crda8_workstreams`
- `crda8_timeoffrequests`
- `crda8_weeklyhours`

## ğŸš€ How to Use This Template

### Step 1: Download on Your PWC Laptop

```bash
# Clone this repo
git clone https://github.com/georgchimion-oss/Test.git
cd Test/template-code-app

# Install dependencies
npm install
```

### Step 2: Update Your App ID

Edit `power.config.json` and replace `YOUR_APP_ID_HERE` with your actual app ID from make.powerapps.com.

### Step 3: Generate Dataverse Hooks

The template includes example files for the GeorgTown table. To add YOUR tables (Staff, Deliverables, etc.), run:

```bash
# Authenticate
pac auth create --environment https://pwc-us-adv-poc.crm.dynamics.com

# Add each table - this generates hooks automatically
pac code add-data-source -a dataverse -t crda8_deliverables
pac code add-data-source -a dataverse -t crda8_staff4
pac code add-data-source -a dataverse -t crda8_workstreams
pac code add-data-source -a dataverse -t crda8_timeoffrequests
pac code add-data-source -a dataverse -t crda8_weeklyhours
```

**IMPORTANT:** Use the TABLE LOGICAL NAME (singular), NOT entity set name (plural).

Each command generates:
- `generated/hooks/use[TableName].ts` - React Query hooks
- `generated/models/[tablename]-model.ts` - TypeScript interfaces
- `generated/services/[tablename]-service.ts` - Dataverse API calls
- `generated/validators/[tablename]-validator.ts` - Zod schemas

### Step 4: Run Locally

```bash
npm run dev
```

### Step 5: Build and Deploy

```bash
npm run build
pac code push
```

## ğŸ“ Folder Structure

```
template-code-app/
â”œâ”€â”€ power.config.json          # Dataverse configuration
â”œâ”€â”€ package.json               # Dependencies
â”œâ”€â”€ tsconfig.json             # TypeScript config
â”œâ”€â”€ vite.config.ts            # Vite build config
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ generated/            # Auto-generated by pac code add-data-source
â”‚   â”‚   â”œâ”€â”€ hooks/           # useStaffList, useDeliverablesList, etc.
â”‚   â”‚   â”œâ”€â”€ models/          # TypeScript interfaces
â”‚   â”‚   â”œâ”€â”€ services/        # API calls to Dataverse
â”‚   â”‚   â””â”€â”€ validators/      # Zod validation schemas
â”‚   â”œâ”€â”€ components/ui/       # Shadcn UI components (optional)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ query-client.ts  # React Query configuration
â”‚   â”‚   â””â”€â”€ utils.ts         # Utility functions
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ layout.tsx       # App layout
â”‚   â”‚   â””â”€â”€ index.tsx        # Home page (example)
â”‚   â”œâ”€â”€ app.tsx              # App component with routing
â”‚   â”œâ”€â”€ main.tsx             # Entry point
â”‚   â””â”€â”€ index.css            # Global styles
â””â”€â”€ README.md                # This file
```

## ğŸ”‘ Key Differences from Manual Approach

### âŒ What We Did Wrong Before:
- Manually created service files with `fetch()`
- Guessed entity set names
- Got 404 errors
- Struggled with authentication

### âœ… What This Template Does Right:
- Uses `pac code add-data-source` to generate everything
- Microsoft's official SDK handles authentication
- Correct entity set names automatically
- TypeScript types generated from your Dataverse schema
- React Query hooks for easy data fetching

## ğŸ“ Example Usage

### Displaying a List

```typescript
import { useStaffList } from '@/generated/hooks/useStaff';

function StaffPage() {
  const { data: staff, isLoading } = useStaffList({
    orderBy: ['name asc']
  });

  if (isLoading) return <div>Loading...</div>;

  return (
    <ul>
      {staff?.map(s => (
        <li key={s.id}>{s.name}</li>
      ))}
    </ul>
  );
}
```

### Creating a Record

```typescript
import { useCreateStaff } from '@/generated/hooks/useStaff';

function AddStaffForm() {
  const createMutation = useCreateStaff();

  const handleSubmit = async () => {
    await createMutation.mutateAsync({
      name: 'John Doe',
      email: 'john@example.com',
      // ... other fields
    });
  };

  return <button onClick={handleSubmit}>Add Staff</button>;
}
```

### Updating a Record

```typescript
import { useUpdateStaff } from '@/generated/hooks/useStaff';

function EditStaff({ staffId }) {
  const updateMutation = useUpdateStaff();

  const handleUpdate = async () => {
    await updateMutation.mutateAsync({
      id: staffId,
      changedFields: {
        name: 'Jane Doe'
      }
    });
  };

  return <button onClick={handleUpdate}>Update</button>;
}
```

## ğŸ› Troubleshooting

### "pac command not found"
Install Power Platform CLI: https://aka.ms/PowerAppsCLI

### "Authentication required"
```bash
pac auth clear
pac auth create --environment https://pwc-us-adv-poc.crm.dynamics.com
```

### "Table not found"
Make sure the table exists in your Dataverse and you're using the correct logical name (singular, like `crda8_staff4`, not `crda8_staff4s`).

### "404 errors when fetching data"
The entity set name in `power.config.json` must match what's in Dataverse. Run `pac code add-data-source` to generate the correct configuration.

## ğŸ“š Official Documentation

- [How to connect code apps to Dataverse](https://learn.microsoft.com/en-us/power-apps/developer/code-apps/how-to/connect-to-dataverse)
- [pac code CLI reference](https://learn.microsoft.com/en-us/power-platform/developer/cli/reference/code)
- [Power Apps Code Apps on GitHub](https://github.com/microsoft/PowerAppsCodeApps)

## ğŸ¯ Next Steps

1. Download this template on your PWC laptop
2. Run `npm install`
3. Run `pac code add-data-source` for each of your tables
4. Update `pages/index.tsx` to use your data
5. Build and deploy with `pac code push`

That's it! You'll have a working Code App connected to your Dataverse tables.
